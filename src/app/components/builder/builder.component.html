<div 
  class="absolute top-4 right-4 w-72 bg-white rounded-lg shadow-lg flex flex-col transition-all duration-300 z-10 overflow-hidden"
  [class.min-h-[60vh]]="isOpen"
  [class.h-12]="!isOpen">
  
  <!-- En-tête du Builder -->
  <div class="flex justify-between items-center p-3 border-b border-gray-200">
    <h2 class="text-lg font-semibold text-gray-800">Builder</h2>
    <button 
      (click)="toggle()" 
      class="flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors">
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        class="h-4 w-4 transition-transform duration-300" 
        [class.rotate-180]="!isOpen"
        viewBox="0 0 20 20" 
        fill="currentColor">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
  </div>
  
  <!-- Contenu du Builder -->
  <div class="flex-1 overflow-y-auto p-2" *ngIf="isOpen">
    <!-- Catégories en accordéon -->
    <div class="flex flex-col space-y-2">
      <div 
        *ngFor="let category of categories" 
        class="border border-gray-200 rounded-md overflow-hidden">
        
        <!-- En-tête de catégorie -->
        <div 
          (click)="toggleCategory(category)" 
          class="flex justify-between items-center p-3 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors">
          <span class="font-medium text-gray-700">{{ category.name }}</span>
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            class="h-4 w-4 text-gray-500 transition-transform duration-300" 
            [class.rotate-180]="!category.expanded"
            viewBox="0 0 20 20" 
            fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>
        
        <!-- Contenu de la catégorie -->
        <div 
          *ngIf="category.expanded" 
          class="p-3 bg-white">
          <div class="grid grid-cols-1 gap-3">
            <!-- Items draggables -->
            <div 
              *ngFor="let item of category.items" 
              class="cursor-grab" 
              fExternalItem 
              [fData]="item.type" 
              [fPreviewMatchSize]="true"
              (pointerdown)="onDragStart(item.type)"
              (dragend)="onDragEnd()">
              <div 
                class="flex items-center p-3 rounded-md shadow-sm text-white hover:shadow-md hover:-translate-y-0.5 transition-all duration-200"
                [ngClass]="item.color">
                <span class="mr-2 text-xl">{{ item.icon }}</span>
                <span>{{ item.type }}</span>
              </div>
              
              <!-- Prévisualisation lors du drag -->
              <ng-template fExternalItemPreview>
                <div 
                  class="flex items-center p-3 rounded-md shadow-sm text-white opacity-70"
                  [ngClass]="item.color">
                  <span class="mr-2 text-xl">{{ item.icon }}</span>
                  <span>{{ item.type }}</span>
                </div>
              </ng-template>
              
              <!-- Placeholder dans le canvas -->
              <ng-template fExternalItemPlaceholder>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 